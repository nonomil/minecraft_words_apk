# å…¨å±ä¼˜åŒ–å®æ–½è®¡åˆ’

> åŸºäº `å…¨å±é—®é¢˜åˆ†æ.md` éœ€æ±‚ï¼Œå‚è€ƒ `mario-minecraft-game_V1/apk` çš„å±å¹•é€‚é…æ–¹æ¡ˆ

## ä¸€ã€ç°çŠ¶åˆ†æ

### å½“å‰é—®é¢˜

1. **å­¦ä¹ åŒºåŸŸæœªå…¨å±**ï¼šå­¦ä¹ æ¨¡å¼ï¼ˆLearnï¼‰å’Œæµ‹éªŒæ¨¡å¼ï¼ˆQuizï¼‰åœ¨ç§»åŠ¨ç«¯åªæ˜¯é¡µé¢çš„ä¸€éƒ¨åˆ†ï¼Œå­—ä½“åå°ï¼Œæ“ä½œä¸ä¾¿
2. **æ»‘åŠ¨æº¢å‡º**ï¼šåœ¨å­¦ä¹ åŒºåŸŸå·¦å³/ä¸Šä¸‹æ»‘åŠ¨æ—¶å®¹æ˜“æ»‘å‡ºå­¦ä¹ åŒºåŸŸï¼Œè§¦å‘é¡µé¢æ»šåŠ¨æˆ–å¯¼èˆªåˆ‡æ¢
3. **ç¼ºå°‘ç‹¬ç«‹å…¨å±è§†å›¾**ï¼šå­¦ä¹ åŒºåŸŸæ²¡æœ‰ç‹¬ç«‹çš„å…¨å±å¼¹çª—ç•Œé¢ï¼Œä¸é¦–é¡µæ··åœ¨ä¸€èµ·
4. **æ¨ªå±æœªå¼ºåˆ¶**ï¼šå½“å‰ç§»åŠ¨ç«¯é»˜è®¤ç«–å±ï¼ˆportraitï¼‰ï¼Œå­¦ä¹ å†…å®¹æ˜¾ç¤ºé¢ç§¯æœ‰é™
5. **å±å¹•é€‚é…ä¸å®Œå–„**ï¼šç¼ºå°‘åƒ mario é¡¹ç›®é‚£æ ·çš„å¤šå±‚çº§å±å¹•é€‚é…æœºåˆ¶

### å½“å‰æ¶æ„

- åŒå¸ƒå±€ç³»ç»Ÿï¼š`.desktop-layout`ï¼ˆ>768pxï¼‰å’Œ `.mobile-layout`ï¼ˆâ‰¤768pxï¼‰
- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ åˆ‡æ¢è§†å›¾
- `device-mode.js` æ§åˆ¶å±å¹•æ–¹å‘ï¼ˆç«–å±/æ¨ªå±/è‡ªåŠ¨ï¼‰
- `mobile-app.js` ç®¡ç†ç§»åŠ¨ç«¯è§†å›¾åˆ‡æ¢å’Œå†…å®¹è¿ç§»
- Capacitor + `@capacitor/screen-orientation` æ§åˆ¶åŸç”Ÿæ–¹å‘é”å®š

### mario é¡¹ç›®å‚è€ƒè¦ç‚¹

| ç‰¹æ€§ | mario é¡¹ç›®å®ç°æ–¹å¼ |
|------|-------------------|
| å¼ºåˆ¶æ¨ªå± | AndroidManifest: `sensorLandscape` |
| å…¨å±æ²‰æµ¸ | styles.xml: `windowFullscreen=true` + `displayCutoutMode=shortEdges` |
| å®‰å…¨åŒºåŸŸ | CSS `env(safe-area-inset-*)` å˜é‡ |
| è§†å£æ£€æµ‹ | `window.visualViewport` ä¼˜å…ˆï¼Œå¤šçº§é™çº§ |
| åŠ¨æ€ç¼©æ”¾ | åŸºäºåŸºå‡†å°ºå¯¸è®¡ç®— scaleX/scaleY/unit |
| å“åº”å¼ CSS | `clamp()` / `min()` / `max()` / `dvh` / `dvw` |
| è®¾å¤‡æ¨¡å¼ | auto/phone/tablet ä¸‰æ¡£ï¼ŒæŒ‰æœ€çŸ­è¾¹ 768px åˆ†ç•Œ |
| äº‹ä»¶ç›‘å¬ | resize + orientationchange + visualViewport.resizeï¼Œé˜²æŠ–å¤„ç† |

---

## äºŒã€å®æ–½ç›®æ ‡

1. è¿›å…¥å­¦ä¹ /æµ‹éªŒæ¨¡å¼æ—¶ï¼Œå¼¹å‡ºå…¨å±è¦†ç›–å±‚ï¼Œä»…æ˜¾ç¤ºå­¦ä¹ å†…å®¹
2. å…¨å±å­¦ä¹ ç•Œé¢å¼ºåˆ¶æ¨ªå±ï¼Œå­—ä½“æ”¾å¤§ï¼Œå¸ƒå±€ä¼˜åŒ–
3. è§¦æ‘¸äº‹ä»¶é™åˆ¶åœ¨å­¦ä¹ åŒºåŸŸå†…ï¼Œé˜²æ­¢æ»‘åŠ¨æº¢å‡º
4. æä¾›è¿”å›æŒ‰é’®ï¼Œå¯é€€å‡ºå…¨å±å›åˆ°é¦–é¡µ
5. è‡ªé€‚åº”å„ç§å±å¹•åˆ†è¾¨ç‡ï¼ˆæ‰‹æœº/å¹³æ¿ï¼‰ï¼Œå‚è€ƒ mario é¡¹ç›®æ–¹æ¡ˆ
6. é¦–é¡µä¿ç•™å½“å‰å¸ƒå±€ï¼Œå¯é€‰æ‹©å¤šç§å­¦ä¹ æ¨¡å¼

---

## ä¸‰ã€è¯¦ç»†å®æ–½æ­¥éª¤

### ç¬¬ 1 æ­¥ï¼šAndroid åŸç”Ÿå±‚é…ç½®

**ç›®æ ‡**ï¼šä¸ºå…¨å±æ²‰æµ¸å¼ä½“éªŒæ‰“åŸºç¡€

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `android-app/android/app/src/main/res/values/styles.xml`
- `android-app/android/app/src/main/AndroidManifest.xml`
- `android-app/capacitor.config.json`

**å…·ä½“æ”¹åŠ¨**ï¼š

1. `styles.xml` â€” æ·»åŠ å…¨å±æ²‰æµ¸å¼æ ·å¼ï¼š
   ```xml
   <style name="AppTheme.NoActionBar" parent="Theme.AppCompat.NoActionBar">
       <item name="android:windowFullscreen">true</item>
       <item name="android:windowLayoutInDisplayCutoutMode">shortEdges</item>
   </style>
   ```

2. `AndroidManifest.xml` â€” æ·»åŠ é…ç½®å˜æ›´å¤„ç†ï¼ˆä¿æŒå½“å‰æ–¹å‘è®¾ç½®ä¸å˜ï¼Œæ–¹å‘åˆ‡æ¢ç”± JS å±‚æ§åˆ¶ï¼‰ï¼š
   ```xml
   android:configChanges="orientation|keyboardHidden|keyboard|screenSize|locale|smallestScreenSize|screenLayout|uiMode|navigation"
   ```

3. `capacitor.config.json` â€” æ·»åŠ çŠ¶æ€æ é…ç½®ï¼š
   ```json
   {
     "plugins": {
       "StatusBar": {
         "style": "DARK",
         "backgroundColor": "#1a1a1a"
       }
     }
   }
   ```

### ç¬¬ 2 æ­¥ï¼šæ–°å¢å…¨å±è¦†ç›–å±‚ HTML ç»“æ„

**ç›®æ ‡**ï¼šåœ¨ `index.html` ä¸­æ·»åŠ å…¨å±å­¦ä¹ å®¹å™¨

**ä¿®æ”¹æ–‡ä»¶**ï¼š`index.html`

**æ–°å¢ HTML ç»“æ„**ï¼ˆæ’å…¥åˆ° `<body>` æœ«å°¾ã€scripts ä¹‹å‰ï¼‰ï¼š

```html
<!-- å…¨å±å­¦ä¹ è¦†ç›–å±‚ -->
<div id="fullscreenOverlay" class="fullscreen-overlay hidden">
  <!-- é¡¶éƒ¨å·¥å…·æ  -->
  <div class="fs-toolbar">
    <button id="fsBackBtn" class="fs-back-btn" aria-label="è¿”å›é¦–é¡µ">
      â† è¿”å›
    </button>
    <div class="fs-title" id="fsModeTitle">å­¦ä¹ æ¨¡å¼</div>
    <div class="fs-progress" id="fsProgress"></div>
  </div>

  <!-- å…¨å±å­¦ä¹ å†…å®¹åŒº -->
  <div class="fs-content" id="fsContent">
    <!-- å­¦ä¹ /æµ‹éªŒå†…å®¹å°†åŠ¨æ€ç§»å…¥æ­¤å¤„ -->
  </div>
</div>
```

**è®¾è®¡è¯´æ˜**ï¼š
- è¦†ç›–å±‚ä½¿ç”¨ `position: fixed; inset: 0; z-index: 10000` è¦†ç›–æ•´ä¸ªå±å¹•
- å†…å®¹åŒºåŸŸ `fs-content` å æ»¡å‰©ä½™ç©ºé—´ï¼Œå†…éƒ¨æ»šåŠ¨ä¸ä¼šæº¢å‡º
- å·¥å…·æ å›ºå®šåœ¨é¡¶éƒ¨ï¼ŒåŒ…å«è¿”å›æŒ‰é’®ã€æ¨¡å¼æ ‡é¢˜ã€è¿›åº¦ä¿¡æ¯

---

### ç¬¬ 3 æ­¥ï¼šå…¨å±è¦†ç›–å±‚ CSS æ ·å¼

**ç›®æ ‡**ï¼šå®ç°å…¨å±å¸ƒå±€ã€æ¨ªå±é€‚é…ã€å­—ä½“æ”¾å¤§ã€é˜²æ»‘åŠ¨æº¢å‡º

**æ–°å¢æ–‡ä»¶**ï¼š`css/fullscreen-overlay.css`

**æ ¸å¿ƒæ ·å¼**ï¼š

```css
/* ===== å…¨å±è¦†ç›–å±‚åŸºç¡€ ===== */
.fullscreen-overlay {
  position: fixed;
  inset: 0;
  z-index: 10000;
  background: #1a1a1a;
  display: flex;
  flex-direction: column;
  overflow: hidden;               /* é˜²æ­¢æ•´ä½“æ»šåŠ¨æº¢å‡º */
  touch-action: none;             /* é˜»æ­¢é»˜è®¤è§¦æ‘¸è¡Œä¸º */
}

.fullscreen-overlay.hidden {
  display: none;
}

/* ===== å®‰å…¨åŒºåŸŸé€‚é…ï¼ˆå‚è€ƒ mario é¡¹ç›®ï¼‰ ===== */
:root {
  --fs-safe-top: env(safe-area-inset-top, 0px);
  --fs-safe-right: env(safe-area-inset-right, 0px);
  --fs-safe-bottom: env(safe-area-inset-bottom, 0px);
  --fs-safe-left: env(safe-area-inset-left, 0px);
}

/* ===== é¡¶éƒ¨å·¥å…·æ  ===== */
.fs-toolbar {
  display: flex;
  align-items: center;
  padding: 8px 16px;
  padding-top: calc(8px + var(--fs-safe-top));
  padding-left: calc(16px + var(--fs-safe-left));
  padding-right: calc(16px + var(--fs-safe-right));
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  flex-shrink: 0;
  gap: 12px;
  min-height: 48px;
}

.fs-back-btn {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: #fff;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: clamp(14px, 2.5vw, 18px);
  cursor: pointer;
  white-space: nowrap;
}

.fs-title {
  flex: 1;
  text-align: center;
  font-size: clamp(16px, 3vw, 22px);
  font-weight: bold;
}

.fs-progress {
  font-size: clamp(12px, 2vw, 16px);
  opacity: 0.8;
}

/* ===== å†…å®¹åŒºåŸŸ ===== */
.fs-content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  overscroll-behavior: contain;   /* é˜²æ­¢æ»šåŠ¨é“¾ä¼ æ’­ */
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;            /* ä»…å…è®¸å‚ç›´æ»šåŠ¨ */
  padding: 16px;
  padding-bottom: calc(16px + var(--fs-safe-bottom));
  padding-left: calc(16px + var(--fs-safe-left));
  padding-right: calc(16px + var(--fs-safe-right));
}

/* ===== å…¨å±æ¨¡å¼ä¸‹å­—ä½“æ”¾å¤§ ===== */
.fullscreen-overlay .word-card,
.fullscreen-overlay .quiz-card {
  max-width: 90vw;
  margin: 0 auto;
}

.fullscreen-overlay .word-display {
  font-size: clamp(2em, 5vw, 3.5em);
}

.fullscreen-overlay .word-phonetic {
  font-size: clamp(1em, 2.5vw, 1.5em);
}

.fullscreen-overlay .word-translation {
  font-size: clamp(1.2em, 3vw, 2em);
}

.fullscreen-overlay .word-image {
  width: clamp(120px, 25vw, 250px);
  height: clamp(120px, 25vw, 250px);
}

.fullscreen-overlay .choice-btn {
  font-size: clamp(1em, 2.5vw, 1.5em);
  padding: 12px 20px;
  min-height: 48px;
}

/* ===== æ¨ªå±ä¼˜åŒ–å¸ƒå±€ ===== */
@media (orientation: landscape) {
  .fullscreen-overlay .fs-content {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 24px;
  }

  /* æ¨ªå±æ—¶å•è¯å¡ç‰‡å·¦å³åˆ†æ  */
  .fullscreen-overlay .word-card {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 24px;
    max-width: 100%;
  }

  .fullscreen-overlay .word-image-section {
    flex: 0 0 auto;
  }

  .fullscreen-overlay .word-info-section {
    flex: 1;
  }
}

/* ===== åŠ¨æ€è§†å£é«˜åº¦æ”¯æŒ ===== */
@supports (height: 100dvh) {
  .fullscreen-overlay {
    height: 100dvh;
    width: 100dvw;
  }
}
```

---

### ç¬¬ 4 æ­¥ï¼šæ–°å¢å…¨å±ç®¡ç†å™¨ JS æ¨¡å—

**ç›®æ ‡**ï¼šç®¡ç†å…¨å±è¦†ç›–å±‚çš„æ‰“å¼€/å…³é—­ã€å†…å®¹è¿ç§»ã€æ–¹å‘é”å®š

**æ–°å¢æ–‡ä»¶**ï¼š`js/fullscreen-manager.js`

**æ ¸å¿ƒé€»è¾‘**ï¼š

```javascript
/**
 * FullscreenManager - å…¨å±å­¦ä¹ è¦†ç›–å±‚ç®¡ç†
 *
 * èŒè´£ï¼š
 * 1. æ‰“å¼€/å…³é—­å…¨å±è¦†ç›–å±‚
 * 2. å°†å­¦ä¹ /æµ‹éªŒå†…å®¹è¿ç§»åˆ°å…¨å±å®¹å™¨
 * 3. è¿›å…¥å…¨å±æ—¶é”å®šæ¨ªå±æ–¹å‘
 * 4. é€€å‡ºå…¨å±æ—¶æ¢å¤åŸæ–¹å‘
 * 5. é˜²æ­¢è§¦æ‘¸äº‹ä»¶æº¢å‡º
 * 6. åŠ¨æ€è§†å£å°ºå¯¸é€‚é…
 */

class FullscreenManager {
  constructor() {
    this.overlay = null;
    this.content = null;
    this.backBtn = null;
    this.titleEl = null;
    this.isOpen = false;
    this.currentMode = null;        // 'learn' | 'quiz'
    this.originalParent = null;     // å†…å®¹åŸå§‹çˆ¶å®¹å™¨ï¼ˆç”¨äºé€€å‡ºæ—¶å½’è¿˜ï¼‰
    this.originalOrientation = null;
  }

  init() {
    this.overlay = document.getElementById('fullscreenOverlay');
    this.content = document.getElementById('fsContent');
    this.backBtn = document.getElementById('fsBackBtn');
    this.titleEl = document.getElementById('fsModeTitle');

    // è¿”å›æŒ‰é’®äº‹ä»¶
    this.backBtn.addEventListener('click', () => this.close());

    // é˜²æ­¢è§¦æ‘¸æº¢å‡º
    this.overlay.addEventListener('touchmove', (e) => {
      // ä»…å…è®¸ fs-content å†…éƒ¨æ»šåŠ¨
      if (!this.content.contains(e.target)) {
        e.preventDefault();
      }
    }, { passive: false });

    // ç›‘å¬è§†å£å˜åŒ–ï¼ˆå‚è€ƒ mario é¡¹ç›®ï¼‰
    this._onResize = this._debounce(() => this._adjustLayout(), 100);
    window.addEventListener('resize', this._onResize);
    window.addEventListener('orientationchange', this._onResize);
    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize', this._onResize);
    }
  }

  /**
   * æ‰“å¼€å…¨å±å­¦ä¹ ç•Œé¢
   * @param {'learn'|'quiz'} mode - å­¦ä¹ æ¨¡å¼
   */
  async open(mode) {
    this.currentMode = mode;

    // 1. é”å®šæ¨ªå±
    await this._lockLandscape();

    // 2. è¿ç§»å†…å®¹åˆ°å…¨å±å®¹å™¨
    this._moveContentIn(mode);

    // 3. æ›´æ–°æ ‡é¢˜
    this.titleEl.textContent = mode === 'learn' ? 'å­¦ä¹ æ¨¡å¼' : 'æµ‹éªŒæ¨¡å¼';

    // 4. æ˜¾ç¤ºè¦†ç›–å±‚
    this.overlay.classList.remove('hidden');
    this.isOpen = true;

    // 5. è°ƒæ•´å¸ƒå±€
    this._adjustLayout();

    // 6. ç¦æ­¢ body æ»šåŠ¨
    document.body.style.overflow = 'hidden';
  }

  /**
   * å…³é—­å…¨å±ï¼Œè¿”å›é¦–é¡µ
   */
  async close() {
    if (!this.isOpen) return;

    // 1. å½’è¿˜å†…å®¹åˆ°åŸå®¹å™¨
    this._moveContentOut();

    // 2. éšè—è¦†ç›–å±‚
    this.overlay.classList.add('hidden');
    this.isOpen = false;

    // 3. æ¢å¤æ–¹å‘
    await this._unlockOrientation();

    // 4. æ¢å¤ body æ»šåŠ¨
    document.body.style.overflow = '';

    // 5. åˆ‡æ¢å›é¦–é¡µè§†å›¾
    if (typeof switchToView === 'function') {
      switchToView('home');
    }
  }

  /** å°†å­¦ä¹ /æµ‹éªŒå†…å®¹ç§»å…¥å…¨å±å®¹å™¨ */
  _moveContentIn(mode) {
    const sourceId = mode === 'learn' ? 'learnMode' : 'quizMode';
    const source = document.getElementById(sourceId);
    if (source) {
      this.originalParent = source.parentElement;
      this.content.appendChild(source);
      source.style.display = 'block';
    }
  }

  /** å°†å†…å®¹å½’è¿˜åŸå®¹å™¨ */
  _moveContentOut() {
    if (this.originalParent && this.content.firstElementChild) {
      this.originalParent.appendChild(this.content.firstElementChild);
    }
  }

  /** é”å®šæ¨ªå±ï¼ˆCapacitor ä¼˜å…ˆï¼ŒWeb API é™çº§ï¼‰ */
  async _lockLandscape() {
    try {
      // Capacitor ScreenOrientation æ’ä»¶
      if (window.Capacitor?.Plugins?.ScreenOrientation) {
        this.originalOrientation = await window.Capacitor.Plugins
          .ScreenOrientation.orientation();
        await window.Capacitor.Plugins.ScreenOrientation
          .lock({ orientation: 'landscape' });
        return;
      }
      // Web Screen Orientation API é™çº§
      if (screen.orientation?.lock) {
        await screen.orientation.lock('landscape');
      }
    } catch (e) {
      console.warn('[FullscreenManager] æ¨ªå±é”å®šå¤±è´¥:', e);
    }
  }

  /** è§£é”æ–¹å‘ */
  async _unlockOrientation() {
    try {
      if (window.Capacitor?.Plugins?.ScreenOrientation) {
        await window.Capacitor.Plugins.ScreenOrientation.unlock();
        return;
      }
      if (screen.orientation?.unlock) {
        screen.orientation.unlock();
      }
    } catch (e) {
      console.warn('[FullscreenManager] æ–¹å‘è§£é”å¤±è´¥:', e);
    }
  }

  /** è°ƒæ•´å¸ƒå±€å°ºå¯¸ï¼ˆå‚è€ƒ mario é¡¹ç›® visualViewport æ–¹æ¡ˆï¼‰ */
  _adjustLayout() {
    if (!this.isOpen) return;
    const vv = window.visualViewport;
    const w = vv ? vv.width : window.innerWidth;
    const h = vv ? vv.height : window.innerHeight;

    // åŠ¨æ€è®¾ç½® CSS å˜é‡ä¾›å­å…ƒç´ ä½¿ç”¨
    this.overlay.style.setProperty('--fs-vw', `${w}px`);
    this.overlay.style.setProperty('--fs-vh', `${h}px`);

    // æ ¹æ®å±å¹•å°ºå¯¸è®¡ç®—ç¼©æ”¾å› å­ï¼ˆå‚è€ƒ mario çš„ computeWorldScaleï¼‰
    const baseW = 800, baseH = 600;
    const scale = Math.min(w / baseW, h / baseH);
    this.overlay.style.setProperty('--fs-scale', scale.toFixed(3));
  }

  _debounce(fn, delay) {
    let timer;
    return (...args) => {
      clearTimeout(timer);
      timer = setTimeout(() => fn.apply(this, args), delay);
    };
  }
}

// å…¨å±€å®ä¾‹
const fullscreenManager = new FullscreenManager();
```

---

### ç¬¬ 5 æ­¥ï¼šé›†æˆå…¨å±ç®¡ç†å™¨åˆ°ç°æœ‰ä»£ç 

**ç›®æ ‡**ï¼šåœ¨ç”¨æˆ·ç‚¹å‡»å­¦ä¹ /æµ‹éªŒæ—¶è§¦å‘å…¨å±æ¨¡å¼

**ä¿®æ”¹æ–‡ä»¶**ï¼š

#### 5.1 `index.html` â€” å¼•å…¥æ–°æ–‡ä»¶

åœ¨ `<head>` ä¸­æ·»åŠ æ ·å¼å¼•ç”¨ï¼š
```html
<link rel="stylesheet" href="css/fullscreen-overlay.css">
```

åœ¨å…¶ä»– JS ä¹‹åã€`main.js` ä¹‹å‰æ·»åŠ è„šæœ¬å¼•ç”¨ï¼š
```html
<script src="js/fullscreen-manager.js"></script>
```

#### 5.2 `js/main.js` â€” åˆå§‹åŒ–å…¨å±ç®¡ç†å™¨

åœ¨åº”ç”¨åˆå§‹åŒ–æµç¨‹ä¸­æ·»åŠ ï¼š
```javascript
// åœ¨ DOMContentLoaded æˆ–ç°æœ‰ init æµç¨‹ä¸­
fullscreenManager.init();
```

#### 5.3 `js/mobile-app.js` â€” æ‹¦æˆªæ¨¡å¼åˆ‡æ¢

ä¿®æ”¹ `switchToView()` å‡½æ•°ï¼Œå½“åˆ‡æ¢åˆ° learn/quiz æ—¶è°ƒç”¨å…¨å±ï¼š
```javascript
// åœ¨ switchToView å‡½æ•°ä¸­
if (viewName === 'learn' || viewName === 'quiz') {
  fullscreenManager.open(viewName);
  return; // ä¸æ‰§è¡ŒåŸæœ‰çš„è§†å›¾åˆ‡æ¢é€»è¾‘
}
```

#### 5.4 `js/game.js` â€” æ¡Œé¢ç«¯æ¨¡å¼æŒ‰é’®ä¹Ÿè§¦å‘å…¨å±

ä¿®æ”¹æ¡Œé¢ç«¯çš„å­¦ä¹ /æµ‹éªŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼š
```javascript
// æ¡Œé¢ç«¯æ¨¡å¼æŒ‰é’®ç‚¹å‡»
document.querySelector('[data-mode="learn"]')?.addEventListener('click', () => {
  fullscreenManager.open('learn');
});
document.querySelector('[data-mode="quiz"]')?.addEventListener('click', () => {
  fullscreenManager.open('quiz');
});
```

---

### ç¬¬ 6 æ­¥ï¼šè§¦æ‘¸äº‹ä»¶é˜²æº¢å‡ºå¤„ç†

**ç›®æ ‡**ï¼šç¡®ä¿åœ¨å…¨å±å­¦ä¹ ç•Œé¢ä¸­ï¼Œè§¦æ‘¸æ“ä½œä¸ä¼šè¶…å‡ºå­¦ä¹ åŒºåŸŸ

**ä¿®æ”¹æ–‡ä»¶**ï¼š`js/fullscreen-manager.js`ï¼ˆåœ¨ init æ–¹æ³•ä¸­å¢å¼ºï¼‰

**å…·ä½“æªæ–½**ï¼š

1. **overscroll-behavior: contain**ï¼ˆCSS å±‚ï¼‰â€” å·²åœ¨ç¬¬ 3 æ­¥ CSS ä¸­è®¾ç½®ï¼Œé˜»æ­¢æ»šåŠ¨é“¾ä¼ æ’­
2. **touch-action æ§åˆ¶**ï¼ˆCSS å±‚ï¼‰â€” è¦†ç›–å±‚ `touch-action: none`ï¼Œå†…å®¹åŒº `touch-action: pan-y`
3. **JS å±‚å…œåº•**ï¼š
   ```javascript
   // é˜»æ­¢è¦†ç›–å±‚ä¸Šçš„é»˜è®¤è§¦æ‘¸è¡Œä¸ºï¼ˆé˜²æ­¢é¡µé¢æ»šåŠ¨/ç¼©æ”¾ï¼‰
   this.overlay.addEventListener('touchstart', (e) => {
     if (!this.content.contains(e.target) && e.target !== this.backBtn) {
       e.preventDefault();
     }
   }, { passive: false });

   // é˜»æ­¢å¤šæŒ‡ç¼©æ”¾
   this.overlay.addEventListener('gesturestart', (e) => e.preventDefault());
   ```

4. **é€‰æ‹©é¢˜æ»‘åŠ¨ä¼˜åŒ–**ï¼š
   ```javascript
   // é€‰æ‹©é¢˜æŒ‰é’®åŒºåŸŸå…è®¸æ°´å¹³æ»‘åŠ¨ï¼ˆå¦‚æœæœ‰æ¨ªå‘æ»šåŠ¨çš„é€‰é¡¹ï¼‰
   // ä½†é™åˆ¶åœ¨å®¹å™¨å†…
   this.content.addEventListener('touchmove', (e) => {
     const el = e.target.closest('.fs-content');
     if (el && el.scrollHeight <= el.clientHeight) {
       // å†…å®¹ä¸éœ€è¦æ»šåŠ¨æ—¶ï¼Œé˜»æ­¢æ‰€æœ‰æ»‘åŠ¨
       e.preventDefault();
     }
   }, { passive: false });
   ```

---

### ç¬¬ 7 æ­¥ï¼šå±å¹•è‡ªé€‚åº”ç³»ç»Ÿï¼ˆå‚è€ƒ mario é¡¹ç›®ï¼‰

**ç›®æ ‡**ï¼šå®ç°å¤šåˆ†è¾¨ç‡è‡ªé€‚åº”ï¼Œç¡®ä¿åœ¨ä¸åŒæ‰‹æœº/å¹³æ¿ä¸Šæ˜¾ç¤ºæ•ˆæœä¸€è‡´

**æ–°å¢æ–‡ä»¶**ï¼š`js/viewport-adapter.js`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

```javascript
/**
 * ViewportAdapter - è§†å£é€‚é…å™¨ï¼ˆå‚è€ƒ mario 07-viewport.jsï¼‰
 *
 * åŠŸèƒ½ï¼š
 * 1. è·å–å‡†ç¡®çš„è§†å£å°ºå¯¸ï¼ˆä¼˜å…ˆ visualViewportï¼‰
 * 2. è®¡ç®—å®‰å…¨åŒºåŸŸå†…çš„å¯ç”¨é¢ç§¯
 * 3. æ ¹æ®åŸºå‡†å°ºå¯¸è®¡ç®—ç¼©æ”¾å› å­
 * 4. è®¾å¤‡ç±»å‹æ£€æµ‹ï¼ˆphone/tabletï¼‰
 * 5. åŠ¨æ€æ›´æ–° CSS å˜é‡
 */

class ViewportAdapter {
  constructor() {
    this.baseSize = { width: 800, height: 600 }; // åŸºå‡†è®¾è®¡å°ºå¯¸
  }

  /** è·å–è§†å£å°ºå¯¸ï¼ˆå‚è€ƒ mario getViewportSizeï¼‰ */
  getViewportSize() {
    const vv = window.visualViewport;
    if (vv && vv.width > 0 && vv.height > 0) {
      return { width: vv.width, height: vv.height };
    }
    return {
      width: window.innerWidth || document.documentElement.clientWidth,
      height: window.innerHeight || document.documentElement.clientHeight
    };
  }

  /** è·å–å®‰å…¨åŒºåŸŸå†…è¾¹è· */
  getSafeInsets() {
    const style = getComputedStyle(document.documentElement);
    return {
      top: parseFloat(style.getPropertyValue('--fs-safe-top')) || 0,
      right: parseFloat(style.getPropertyValue('--fs-safe-right')) || 0,
      bottom: parseFloat(style.getPropertyValue('--fs-safe-bottom')) || 0,
      left: parseFloat(style.getPropertyValue('--fs-safe-left')) || 0
    };
  }

  /** è·å–å¯ç”¨æ¸¸æˆåŒºåŸŸï¼ˆå‡å»å®‰å…¨åŒºåŸŸï¼‰ */
  getUsableArea() {
    const vp = this.getViewportSize();
    const insets = this.getSafeInsets();
    return {
      width: Math.max(1, vp.width - insets.left - insets.right),
      height: Math.max(1, vp.height - insets.top - insets.bottom)
    };
  }

  /** è®¡ç®—ç¼©æ”¾å› å­ï¼ˆå‚è€ƒ mario computeWorldScaleï¼‰ */
  computeScale() {
    const area = this.getUsableArea();
    const scaleX = area.width / this.baseSize.width;
    const scaleY = area.height / this.baseSize.height;
    const unit = Math.min(scaleX, scaleY);
    return { scaleX, scaleY, unit };
  }

  /** æ£€æµ‹è®¾å¤‡ç±»å‹ï¼ˆå‚è€ƒ mario æ–¹æ¡ˆï¼Œæœ€çŸ­è¾¹ 768px åˆ†ç•Œï¼‰ */
  detectDevice() {
    const vp = this.getViewportSize();
    const shortSide = Math.min(vp.width, vp.height);
    return shortSide < 768 ? 'phone' : 'tablet';
  }

  /** æ›´æ–° CSS å˜é‡ */
  applyToCSS(targetEl = document.documentElement) {
    const vp = this.getViewportSize();
    const scale = this.computeScale();
    const device = this.detectDevice();

    targetEl.style.setProperty('--fs-vw', `${vp.width}px`);
    targetEl.style.setProperty('--fs-vh', `${vp.height}px`);
    targetEl.style.setProperty('--fs-scale', scale.unit.toFixed(3));
    targetEl.style.setProperty('--fs-device', device);

    // æ ¹æ®ç¼©æ”¾å› å­è°ƒæ•´åŸºç¡€å­—ä½“å¤§å°
    const baseFontSize = Math.max(14, Math.min(22, 16 * scale.unit));
    targetEl.style.setProperty('--fs-base-font', `${baseFontSize.toFixed(1)}px`);
  }
}

const viewportAdapter = new ViewportAdapter();
```

---

### ç¬¬ 8 æ­¥ï¼šé¦–é¡µä¼˜åŒ–

**ç›®æ ‡**ï¼šé¦–é¡µä½œä¸ºå­¦ä¹ æ¨¡å¼é€‰æ‹©å…¥å£ï¼Œæ¸…æ™°å±•ç¤ºå¯ç”¨æ¨¡å¼

**ä¿®æ”¹æ–‡ä»¶**ï¼š`index.html`ã€`css/mobile-app.css`

**æ”¹åŠ¨è¦ç‚¹**ï¼š

1. é¦–é¡µï¼ˆ`#mobile-home`ï¼‰å¢åŠ é†’ç›®çš„æ¨¡å¼é€‰æ‹©å¡ç‰‡ï¼š
   - ğŸ“š å•è¯å­¦ä¹ ï¼ˆè¿›å…¥å…¨å±å­¦ä¹ ï¼‰
   - ğŸ”¤ æ‹¼å†™æµ‹éªŒï¼ˆè¿›å…¥å…¨å±æµ‹éªŒï¼‰
   - âš™ï¸ è®¾ç½®ï¼ˆä¿æŒå½“å‰è¡Œä¸ºï¼‰

2. å¡ç‰‡æ ·å¼ä¼˜åŒ–ï¼š
   - å¤§å›¾æ ‡ + æ–‡å­—æè¿°
   - è§¦æ‘¸å‹å¥½çš„å°ºå¯¸ï¼ˆæœ€å° 48px è§¦æ‘¸ç›®æ ‡ï¼‰
   - ç½‘æ ¼å¸ƒå±€ï¼Œè‡ªé€‚åº”å±å¹•å®½åº¦

3. é¦–é¡µä¿æŒå½“å‰æ–¹å‘ï¼ˆç«–å±æˆ–è‡ªåŠ¨ï¼‰ï¼Œä»…è¿›å…¥å­¦ä¹ æ—¶åˆ‡æ¢æ¨ªå±

---

## å››ã€æ–‡ä»¶å˜æ›´æ¸…å•

| æ“ä½œ | æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|------|---------|------|
| æ–°å¢ | `css/fullscreen-overlay.css` | å…¨å±è¦†ç›–å±‚æ ·å¼ |
| æ–°å¢ | `js/fullscreen-manager.js` | å…¨å±ç®¡ç†å™¨ |
| æ–°å¢ | `js/viewport-adapter.js` | è§†å£é€‚é…å™¨ |
| ä¿®æ”¹ | `index.html` | æ·»åŠ å…¨å±è¦†ç›–å±‚ HTMLã€å¼•å…¥æ–° CSS/JS |
| ä¿®æ”¹ | `js/main.js` | åˆå§‹åŒ–å…¨å±ç®¡ç†å™¨å’Œè§†å£é€‚é…å™¨ |
| ä¿®æ”¹ | `js/mobile-app.js` | æ‹¦æˆª learn/quiz åˆ‡æ¢ï¼Œè§¦å‘å…¨å± |
| ä¿®æ”¹ | `js/game.js` | æ¡Œé¢ç«¯æ¨¡å¼æŒ‰é’®è§¦å‘å…¨å± |
| ä¿®æ”¹ | `android-app/android/.../styles.xml` | å…¨å±æ²‰æµ¸å¼ä¸»é¢˜ |
| ä¿®æ”¹ | `android-app/android/.../AndroidManifest.xml` | configChanges é…ç½® |
| ä¿®æ”¹ | `android-app/capacitor.config.json` | çŠ¶æ€æ é…ç½® |

---

## äº”ã€å®æ–½é¡ºåºä¸ä¾èµ–å…³ç³»

```
ç¬¬ 1 æ­¥ Android åŸç”Ÿé…ç½® â”€â”€â”
                           â”œâ”€â”€â†’ ç¬¬ 5 æ­¥ é›†æˆåˆ°ç°æœ‰ä»£ç  â”€â”€â†’ ç¬¬ 8 æ­¥ é¦–é¡µä¼˜åŒ–
ç¬¬ 2 æ­¥ HTML ç»“æ„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                           â”‚
ç¬¬ 3 æ­¥ CSS æ ·å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                           â”‚
ç¬¬ 4 æ­¥ å…¨å±ç®¡ç†å™¨ JS â”€â”€â”€â”€â”€â”˜
                                    â†‘
ç¬¬ 6 æ­¥ è§¦æ‘¸é˜²æº¢å‡º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†‘
ç¬¬ 7 æ­¥ è§†å£é€‚é…å™¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ç¬¬ 1~4 æ­¥å¯å¹¶è¡Œå¼€å‘ï¼Œäº’ä¸ä¾èµ–
- ç¬¬ 5 æ­¥ä¾èµ– 1~4 æ­¥å…¨éƒ¨å®Œæˆ
- ç¬¬ 6ã€7 æ­¥æ˜¯ç¬¬ 4 æ­¥çš„å¢å¼ºï¼Œå¯åœ¨ç¬¬ 5 æ­¥ä¹‹åé›†æˆ
- ç¬¬ 8 æ­¥æ˜¯æœ€åçš„é¦–é¡µ UI ä¼˜åŒ–

---

## å…­ã€æµ‹è¯•è¦ç‚¹

1. **å…¨å±è¿›å…¥/é€€å‡º**ï¼šç‚¹å‡»å­¦ä¹ /æµ‹éªŒ â†’ å…¨å±æ¨ªå±æ˜¾ç¤º â†’ ç‚¹è¿”å› â†’ å›åˆ°é¦–é¡µç«–å±
2. **è§¦æ‘¸é˜²æº¢å‡º**ï¼šåœ¨å…¨å±å­¦ä¹ ç•Œé¢ä¸Šä¸‹å·¦å³æ»‘åŠ¨ï¼Œä¸åº”è¶…å‡ºå­¦ä¹ åŒºåŸŸ
3. **å­—ä½“å¤§å°**ï¼šæ¨ªå±å…¨å±ä¸‹å•è¯ã€éŸ³æ ‡ã€ç¿»è¯‘å­—ä½“æ˜æ˜¾å¤§äºå½“å‰ç‰ˆæœ¬
4. **å¤šåˆ†è¾¨ç‡**ï¼šåœ¨ä¸åŒå°ºå¯¸è®¾å¤‡ä¸Šæµ‹è¯•ï¼ˆå°å±æ‰‹æœºã€å¤§å±æ‰‹æœºã€å¹³æ¿ï¼‰
5. **å®‰å…¨åŒºåŸŸ**ï¼šæœ‰åˆ˜æµ·/æŒ–å­”å±çš„è®¾å¤‡ä¸Šå†…å®¹ä¸è¢«é®æŒ¡
6. **æ–¹å‘åˆ‡æ¢**ï¼šä»ç«–å±é¦–é¡µè¿›å…¥æ¨ªå±å­¦ä¹ ï¼Œå†è¿”å›ç«–å±é¦–é¡µï¼Œæ–¹å‘åˆ‡æ¢æµç•…
7. **å†…å®¹å®Œæ•´æ€§**ï¼šå…¨å±æ¨¡å¼ä¸‹å­¦ä¹ /æµ‹éªŒçš„æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼ˆé€‰æ‹©é¢˜ã€éŸ³é¢‘æ’­æ”¾ã€è¿›åº¦ç­‰ï¼‰
8. **æ¡Œé¢ç«¯å…¼å®¹**ï¼šæ¡Œé¢æµè§ˆå™¨ä¸­å…¨å±è¦†ç›–å±‚ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼ˆä¸å¼ºåˆ¶æ¨ªå±ï¼‰
