# 全屏学习区改造-最终实施计划

日期：2026-02-18  
项目：`D:\Workplace\minecraft_words_apk-main`  
合并来源：
- `docs/全屏问题分析/全屏问题分析.md`
- `docs/全屏问题分析/全屏优化实施计划.md`
- `docs/全屏问题分析/2026-02-18-fullscreen-learning-area-execution-plan.md`

## 1. 最终决策（已确认）

1. 方向策略：`AndroidManifest.xml` 使用 `sensorLandscape` 作为原生默认横屏，Web 层仅兜底。  
2. 架构策略：复用现有 `mobile-app.js` 视图切换机制，不再新建并行窗口系统。  
3. 全屏策略：基于现有 `#mobile-learn` / `#mobile-quiz` 做全屏化增强，不新增第二套状态机。

## 2. 现状核实结论

1. 当前运行主链路是 `js/mobile-app.js` + `js/device-mode.js`。  
2. `#mobile-learn` / `#mobile-quiz` 已有固定结构：`.mobile-view-header` + `.mobile-view-content`（其中 `#mobile-learn-content` / `#mobile-quiz-content` 是内容迁移目标）。  
3. `mobile-simple-overlay` 在 `index.html` 中被注释包裹，属于可参考原型；清理前必须先确认无 JS 运行时引用。  
4. 存在配置收敛问题：`capacitor.config.json` 可能存在多份来源，必须先统一。  
5. 存在页面脚本重复加载风险（需在实施中清理）。

## 3. 实施目标

1. 学习/测验进入全屏学习视图，只保留学习相关内容。  
2. 滑动手势不溢出到页面级滚动，不出现“滑出学习区”。  
3. 提供固定返回按钮，返回首页视图。  
4. APK 默认横屏稳定运行，适配手机/平板分辨率。  
5. 首页及多模式入口（学习/拼写/设置）保持可用且不回归。

## 4. 执行阶段

### 阶段 A：原生与配置基线（先做）

涉及文件：
- `android-app/android/app/src/main/AndroidManifest.xml`
- `android-app/android/app/src/main/res/values/styles.xml`
- 生效的 `capacitor.config.json`（统一唯一来源）

任务：
1. 将 `MainActivity` 方向改为 `sensorLandscape`。  
2. 补齐沉浸式全屏参数（`windowFullscreen`、`windowLayoutInDisplayCutoutMode`）。  
3. 统一 Capacitor 配置文件来源，消除多份配置不一致。  
4. 完成一次 `cap sync` 基线验证。

验收：
1. 冷启动即横屏，无方向闪烁。  
2. 刘海/挖孔屏区域不遮挡核心操作。

### 阶段 B：Web 全屏学习视图改造（核心）

涉及文件：
- `index.html`
- `css/mobile-app.css`（必要时补充 `css/fullscreen-learning.css`）
- `js/mobile-app.js`

任务：
1. 基于现有 `.mobile-view-header` 做增强（加返回按钮、模式标题、进度位），不新建并替换 `fs-toolbar/fs-content`。  
2. 保留 `#mobile-learn-content` / `#mobile-quiz-content` 这两个既有 ID，不修改 `moveContentToMobile()` 的迁移目标。  
3. 为学习/测验视图加全屏态 class（如 `fullscreen-mode`），隐藏无关导航区域。  
4. 放大词卡、按钮、文字（横屏优先）。  
5. 进入/退出全屏时保持内容迁移流程稳定（不引入第二套迁移逻辑）。

验收：
1. 进入学习后仅展示学习区。  
2. 返回按钮始终可见且可回首页。

### 阶段 C：触摸边界与滚动防溢出

涉及文件：
- `css/mobile-app.css`
- `js/mobile-app.js`

任务：
1. 全屏容器加 `overflow: hidden` + `overscroll-behavior: contain`。  
2. 内容区限定滚动方向与滚动容器边界。  
3. JS 层仅在全屏激活时做触摸兜底拦截，避免影响其他模式。

验收：
1. 上下左右滑动不触发页面级滑出。  
2. 学习区内操作连续稳定。

### 阶段 D：分辨率适配与样式稳态

涉及文件：
- `css/styles.css`
- `css/mobile-app.css`

任务：
1. 补齐横屏关键断点（低高度、高宽度、平板）。  
2. 使用 `dvh/dvw` + `safe-area` 变量保证可视区域准确。  
3. 控制最小触控尺寸（>=44px）和最小可读字号。
4. 首页 `#mobile-home` 横屏布局改造设为必做项（卡片由竖向堆叠改为横向/网格），不得保留竖屏专用排版。

验收：
1. 手机/小平板/大平板三档不裁切、不重叠、可点击。

### 阶段 E：回归与发布准备

涉及文件：
- `docs/reports/` 下新增测试报告

任务：
1. 全流程回归：学习、拼写、设置、返回首页、切换模式。  
2. 横屏与前后台切换回归。  
3. 输出问题清单、回滚点和测试 APK。

## 5. 强制约束（实施必须遵守）

1. 单一入口：移动端视图切换统一走 `js/mobile-app.js`。  
2. 方向优先级：原生优先，JS 兜底；原生环境避免重复 lock/unlock。  
3. 配置收敛：只保留一份生效的 Capacitor 配置来源。  
4. 渐进改造：每阶段独立提交，可回滚。  
5. 不并行新建 `fullscreen-manager.js` 与第二套窗口状态机。
6. 退出全屏走 `switchToView('home')` 时必须执行 UI 复原清单：恢复 `.mobile-view-header` 可见、恢复底部导航可见、移除全屏态 class。  
7. `firstLaunchModal` 与原生 `sensorLandscape` 冲突必须处理：要么移除“手机竖屏”选项，要么改为不涉及方向选择的模式说明弹窗。

## 6. 主要风险与对策

1. 风险：多套移动 UI 并存导致状态冲突。  
对策：禁用并清理非主链路入口，保留兼容注释。  

2. 风险：Web 与原生双方向控制冲突。  
对策：增加环境判断，原生环境下减少 JS 主动锁定。  

3. 风险：配置文件不一致导致改动不生效。  
对策：阶段 A 首先完成配置归一与同步验证。  

4. 风险：触摸全局拦截误伤其他页面。  
对策：仅在 `fullscreen-mode` 启用拦截。

5. 风险：注释态 `mobile-simple-overlay` 被误删后触发潜在引用错误。  
对策：先全局检索并确认无运行时引用，再执行清理。

6. 风险：首页横屏未改造导致视觉和可用性明显退化。  
对策：将首页横屏样式作为阶段 D 的必测与必交付项。

## 7. 验收标准（全部满足才完成）

1. 学习/测验进入后为全屏学习视图，首页元素不干扰。  
2. 学习视图内滑动不溢出，操作稳定。  
3. 返回按钮可用，能回首页并继续切换其他模式。  
4. APK 默认横屏，启动与切换无明显抖动。  
5. 三类设备分辨率通过核心流程测试。  
6. 无关键回归（拼写、设置、音频、进度统计）。
7. 首页横屏布局可用且视觉通过（卡片不重叠、不挤压、首屏可操作）。  
8. `firstLaunchModal` 不再提供与横屏策略冲突的竖屏选择路径。

## 8. 建议里程碑

1. M1（D+0.5）：阶段 A 完成。  
2. M2（D+2）：阶段 B/C 完成并可演示。  
3. M3（D+3）：阶段 D 完成。  
4. M4（D+4）：阶段 E 完成并产出测试包。

---

备注：本文件作为唯一执行基线，后续实施与汇报均以本计划为准。
