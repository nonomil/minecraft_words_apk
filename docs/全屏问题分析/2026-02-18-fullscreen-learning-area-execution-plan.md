# 全屏学习区改造执行计划（Plan）

日期：2026-02-18  
项目：`D:\Workplace\minecraft_words_apk-main`  
输入依据：`docs/全屏问题分析/全屏问题分析.md`

## 1. 目标与范围

### 1.1 核心目标

1. APK 进入学习时提供“只显示学习区域”的全屏界面，避免误滑出学习区。  
2. 学习界面支持更大字号、更聚焦的交互，提升儿童操作稳定性。  
3. 全屏学习界面提供明显“返回首页”入口。  
4. 安卓端支持强制横屏方案，并完成多分辨率自适应。  
5. 保持现有首页和多学习模式入口（学习/拼写/设置）可达。

### 1.2 本次改造范围

- Web 层布局与交互改造（学习区全屏容器、滑动边界、返回逻辑）。
- Capacitor Android 宿主方向策略改造（横屏优先）。
- 适配不同屏幕比例（16:9、20:9、平板）。
- 回归测试与打包验收文档。

### 1.3 非目标（本计划不做）

- 不重构词库逻辑与学习算法。  
- 不改动 TTS 核心实现。  
- 不新增复杂动画与主题系统。

## 2. 现状评估（基于代码）

### 2.1 关键文件与现状

1. `index.html`  
- 已存在 `mobile-simple-overlay` 和 `mobileSimpleLearnWindow` 等结构。  
- 已有“返回首页”视觉元素，但未形成完整全屏学习闭环流程。  

2. `js/device-mode.js`  
- 已实现 `lockScreenOrientation(mode)`。  
- 当前 `mobile` 模式锁竖屏，`tablet/desktop` 锁横屏。  

3. `js/mobile-app.js`  
- 通过 `switchToView()` 在 home/learn/quiz/settings 间切换。  
- 学习内容是从桌面容器“搬运”到移动容器，需补充全屏边界与手势限制。  

4. `js/mobile-ui-manager.js`  
- 已有移动窗口系统、`goBack()`、触摸事件监听。  
- 存在 `overflow-y: auto` 的窗口级滚动，学习区与全局滚动边界还需收紧。  

5. `android-app/android/app/src/main/AndroidManifest.xml`  
- `MainActivity` 当前为 `android:screenOrientation="unspecified"`。

## 3. 方案设计

### 3.1 交互方案（用户路径）

1. 首页点击“学习模式”后进入“全屏学习窗口”。  
2. 全屏窗口仅显示学习区核心内容（词卡、选项、进度、控制按钮）。  
3. 顶部固定返回按钮，点击后回到首页窗口。  
4. 学习窗口内允许局部滚动，禁止页面级滑出与穿透滚动。  
5. 保留模式切换入口（首页中仍可进入拼写/设置）。

### 3.2 布局策略

1. 新增或强化“学习主区域容器”（建议命名：`.learn-main-area-fullscreen`）。  
2. 使用 `height: 100dvh` + `overflow: hidden` 锁定全屏边界。  
3. 学习内容区域采用内层滚动，统一 `touch-action` 与 `overscroll-behavior`。  
4. 字号、卡片、按钮按横屏优先进行比例放大。

### 3.3 横屏与分辨率策略

1. Android 宿主层设置 `MainActivity` 默认横屏（`sensorLandscape` 或 `landscape`）。  
2. Web 层对超宽/超窄横屏分别提供断点规则。  
3. 参考 `D:\Workplace\mario-minecraft-game_V1\apk` 的思路：  
- 优先使用“固定逻辑区域 + 自适应缩放/留白”。  
- 控件最小可点击区域不低于 44px。

## 4. 执行计划（分阶段）

### 阶段 A：需求固化与基线确认（0.5 天）

目标：冻结交互边界与验收口径。  
输出：需求确认记录 + UI 结构草图。

任务：
1. 将“全屏学习区”定义为独立窗口，不与首页同层滚动。  
2. 明确返回路径：学习区 -> 首页（不是系统返回直接退出）。  
3. 确认横屏策略：是否仅 APK 强制横屏，H5 保持自动。

### 阶段 B：Web 结构与样式改造（1.5 天）

目标：实现只显示学习区域的全屏 UI。

涉及文件：
- `index.html`
- `css/mobile-app.css`（如样式集中）
- `js/mobile-ui-manager.js`
- `js/mobile-app.js`

任务：
1. 建立学习全屏容器层级，隔离主页与学习区。  
2. 固定顶部导航（返回按钮 + 积分信息可选）。  
3. 重排学习区组件（词卡、选项、进度、控制按钮）。  
4. 放大核心字体与按钮，适配儿童触控。  
5. 收紧滚动：页面禁滚、学习内容区可控滚动。  
6. 阻断误触穿透与边缘滑出。

### 阶段 C：方向锁定与原生配置（0.5 天）

目标：APK 横屏稳定运行。

涉及文件：
- `android-app/android/app/src/main/AndroidManifest.xml`
- `js/device-mode.js`

任务：
1. 将 `MainActivity` 改为横屏策略（建议先 `sensorLandscape`）。  
2. 调整 `device-mode` 中方向锁定优先级，避免与原生策略冲突。  
3. 明确“自动/移动/平板/桌面”模式下的方向行为矩阵。

### 阶段 D：分辨率适配与体验优化（1 天）

目标：主流机型不裁切、不变形、可操作。

涉及文件：
- `css/styles.css`
- `css/mobile-app.css`
- `js/mobile-ui-manager.js`

任务：
1. 增加横屏断点（如 <= 480 高度、>= 1200 宽度）。  
2. 控制词卡最大宽高与最小字号。  
3. 处理安全区与刘海屏（`env(safe-area-inset-*)`）。  
4. 验证学习区在不同 DPR 下的触控命中。

### 阶段 E：测试、打包与回归（1 天）

目标：确认功能稳定并可发布测试包。

任务：
1. 功能测试：进入学习、切词、滑动、返回首页、切换模式。  
2. 方向测试：冷启动、前后台切换、旋转锁定。  
3. 兼容测试：手机横屏、小平板、大平板。  
4. 打包测试 APK 并记录问题清单。

## 5. 验收标准（必须全部满足）

1. 进入学习模式后，仅显示学习区域，不出现首页杂项区块。  
2. 学习区域内滑动不导致页面级“滑出”或内容越界。  
3. 返回按钮始终可见且可回首页。  
4. APK 默认横屏启动，学习页布局无严重错位。  
5. 三类分辨率（手机/小平板/大平板）均通过核心流程测试。  
6. 拼写模式、设置模式入口不回归损坏。

## 6. 风险与对策

1. 风险：多套移动 UI（`mobile-app` 与 `mobile-ui-manager`）并存导致状态冲突。  
对策：确定单一入口管理窗口切换，另一套仅保留必要能力。  

2. 风险：方向锁定在 Web 与原生双重生效引发抖动。  
对策：优先原生锁定，Web 层只做兜底。  

3. 风险：旧机型 `100vh` 高度异常。  
对策：改用 `100dvh` 并保留回退规则。  

4. 风险：触摸事件全局拦截影响其他模块。  
对策：仅在学习全屏窗口激活时启用拦截。

## 7. 回滚策略

1. 所有改造分 PR/分提交进行。  
2. 若横屏策略引发崩溃，先回滚 `AndroidManifest.xml` 方向配置。  
3. 若学习区全屏影响主流程，保留旧入口并加开关（feature flag）快速切回。

## 8. 交付物清单

1. 代码改造 PR（Web + Android）。  
2. 《全屏学习区测试报告》：`docs/reports/2026-02-xx-fullscreen-test-report.md`。  
3. 《问题与回归记录》：`docs/reports/2026-02-xx-fullscreen-regression-log.md`。  
4. 测试 APK（横屏版）。

## 9. 里程碑与工时预估

1. M1（D+0.5）：方案冻结。  
2. M2（D+2）：全屏学习区可用。  
3. M3（D+3）：横屏与适配完成。  
4. M4（D+4）：测试完成并输出 APK。

总预估：3.5 - 4.0 人天。

---

备注：该计划为“先出详细 Plan 文档”的第一步，下一步可直接按阶段 B -> C -> D 顺序落地实现。
